<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>HGAME-Week4-Writeup - 0wl’s Blog</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="0wl’s Blog"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="0wl’s Blog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="Week4"><meta property="og:type" content="blog"><meta property="og:title" content="HGAME-Week4-Writeup"><meta property="og:url" content="https://www.0wl.site/2021/03/27/HGAME-Week4-Writeup/"><meta property="og:site_name" content="0wl’s Blog"><meta property="og:description" content="Week4"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://www.0wl.site/2021/03/27/HGAME-Week4-Writeup/re1(4).png"><meta property="og:image" content="https://www.0wl.site/2021/03/27/HGAME-Week4-Writeup/re1(2).png"><meta property="og:image" content="https://www.0wl.site/2021/03/27/HGAME-Week4-Writeup/re1(3).png"><meta property="og:image" content="https://www.0wl.site/2021/03/27/HGAME-Week4-Writeup/re1.png"><meta property="og:image" content="https://www.0wl.site/2021/03/27/HGAME-Week4-Writeup/re2.png"><meta property="og:image" content="https://www.0wl.site/2021/03/27/HGAME-Week4-Writeup/re2(2).png"><meta property="og:image" content="https://www.0wl.site/2021/03/27/HGAME-Week4-Writeup/re2(3).png"><meta property="og:image" content="https://www.0wl.site/2021/03/27/HGAME-Week4-Writeup/re2(4).png"><meta property="og:image" content="https://www.0wl.site/2021/03/27/HGAME-Week4-Writeup/re2(5).png"><meta property="og:image" content="https://www.0wl.site/2021/03/27/HGAME-Week4-Writeup/re2(6).png"><meta property="og:image" content="https://www.0wl.site/2021/03/27/HGAME-Week4-Writeup/re3(5).png"><meta property="og:image" content="https://www.0wl.site/2021/03/27/HGAME-Week4-Writeup/re3(4).png"><meta property="og:image" content="https://www.0wl.site/2021/03/27/HGAME-Week4-Writeup/re3(3).png"><meta property="og:image" content="https://www.0wl.site/2021/03/27/HGAME-Week4-Writeup/re3(9).png"><meta property="og:image" content="https://www.0wl.site/2021/03/27/HGAME-Week4-Writeup/re3(2).png"><meta property="og:image" content="https://www.0wl.site/2021/03/27/HGAME-Week4-Writeup/re3(6).png"><meta property="og:image" content="https://www.0wl.site/2021/03/27/HGAME-Week4-Writeup/re3.png"><meta property="og:image" content="https://www.0wl.site/2021/03/27/HGAME-Week4-Writeup/misc1(6).png"><meta property="og:image" content="https://www.0wl.site/2021/03/27/HGAME-Week4-Writeup/misc1(5).png"><meta property="og:image" content="https://www.0wl.site/2021/03/27/HGAME-Week4-Writeup/misc1(3).png"><meta property="og:image" content="https://www.0wl.site/2021/03/27/HGAME-Week4-Writeup/misc1(4).jpg"><meta property="og:image" content="https://www.0wl.site/2021/03/27/HGAME-Week4-Writeup/misc1.png"><meta property="og:image" content="https://www.0wl.site/2021/03/27/HGAME-Week4-Writeup/misc1(2).png"><meta property="og:image" content="https://www.0wl.site/2021/03/27/HGAME-Week4-Writeup/flag.png"><meta property="og:image" content="https://www.0wl.site/2021/03/27/HGAME-Week4-Writeup/misc2(5).png"><meta property="og:image" content="https://www.0wl.site/2021/03/27/HGAME-Week4-Writeup/misc2(6).png"><meta property="og:image" content="https://www.0wl.site/2021/03/27/HGAME-Week4-Writeup/misc2.png"><meta property="og:image" content="https://www.0wl.site/2021/03/27/HGAME-Week4-Writeup/misc2(8).png"><meta property="og:image" content="https://www.0wl.site/2021/03/27/HGAME-Week4-Writeup/misc2(7).png"><meta property="og:image" content="https://www.0wl.site/2021/03/27/HGAME-Week4-Writeup/misc2(2).png"><meta property="og:image" content="https://www.0wl.site/2021/03/27/HGAME-Week4-Writeup/misc2(3).png"><meta property="og:image" content="https://www.0wl.site/2021/03/27/HGAME-Week4-Writeup/misc2(4).png"><meta property="article:published_time" content="2021-03-27T07:10:15.000Z"><meta property="article:modified_time" content="2021-11-16T14:54:13.031Z"><meta property="article:author" content="0wl"><meta property="article:tag" content="hgame"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/2021/03/27/HGAME-Week4-Writeup/re1(4).png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.0wl.site/2021/03/27/HGAME-Week4-Writeup/"},"headline":"0wl’s Blog","image":["https://www.0wl.site/2021/03/27/HGAME-Week4-Writeup/re1(4).png","https://www.0wl.site/2021/03/27/HGAME-Week4-Writeup/re1(2).png","https://www.0wl.site/2021/03/27/HGAME-Week4-Writeup/re1(3).png","https://www.0wl.site/2021/03/27/HGAME-Week4-Writeup/re1.png","https://www.0wl.site/2021/03/27/HGAME-Week4-Writeup/re2.png","https://www.0wl.site/2021/03/27/HGAME-Week4-Writeup/re2(2).png","https://www.0wl.site/2021/03/27/HGAME-Week4-Writeup/re2(3).png","https://www.0wl.site/2021/03/27/HGAME-Week4-Writeup/re2(4).png","https://www.0wl.site/2021/03/27/HGAME-Week4-Writeup/re2(5).png","https://www.0wl.site/2021/03/27/HGAME-Week4-Writeup/re2(6).png","https://www.0wl.site/2021/03/27/HGAME-Week4-Writeup/re3(5).png","https://www.0wl.site/2021/03/27/HGAME-Week4-Writeup/re3(4).png","https://www.0wl.site/2021/03/27/HGAME-Week4-Writeup/re3(3).png","https://www.0wl.site/2021/03/27/HGAME-Week4-Writeup/re3(9).png","https://www.0wl.site/2021/03/27/HGAME-Week4-Writeup/re3(2).png","https://www.0wl.site/2021/03/27/HGAME-Week4-Writeup/re3(6).png","https://www.0wl.site/2021/03/27/HGAME-Week4-Writeup/re3.png","https://www.0wl.site/2021/03/27/HGAME-Week4-Writeup/misc1(6).png","https://www.0wl.site/2021/03/27/HGAME-Week4-Writeup/misc1(5).png","https://www.0wl.site/2021/03/27/HGAME-Week4-Writeup/misc1(3).png","https://www.0wl.site/2021/03/27/HGAME-Week4-Writeup/misc1(4).jpg","https://www.0wl.site/2021/03/27/HGAME-Week4-Writeup/misc1.png","https://www.0wl.site/2021/03/27/HGAME-Week4-Writeup/misc1(2).png","https://www.0wl.site/2021/03/27/HGAME-Week4-Writeup/flag.png","https://www.0wl.site/2021/03/27/HGAME-Week4-Writeup/misc2(5).png","https://www.0wl.site/2021/03/27/HGAME-Week4-Writeup/misc2(6).png","https://www.0wl.site/2021/03/27/HGAME-Week4-Writeup/misc2.png","https://www.0wl.site/2021/03/27/HGAME-Week4-Writeup/misc2(8).png","https://www.0wl.site/2021/03/27/HGAME-Week4-Writeup/misc2(7).png","https://www.0wl.site/2021/03/27/HGAME-Week4-Writeup/misc2(2).png","https://www.0wl.site/2021/03/27/HGAME-Week4-Writeup/misc2(3).png","https://www.0wl.site/2021/03/27/HGAME-Week4-Writeup/misc2(4).png"],"datePublished":"2021-03-27T07:10:15.000Z","dateModified":"2021-11-16T14:54:13.031Z","author":{"@type":"Person","name":"0wl"},"description":"Week4"}</script><link rel="canonical" href="https://www.0wl.site/2021/03/27/HGAME-Week4-Writeup/"><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/font-awesome/5.12.0/css/all.min.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/highlight.js/9.12.0/styles/github-gist.min.css"><link rel="stylesheet"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><script>var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "//hm.baidu.com/hm.js?50fcb826e7ea18041d7e21129d7347e5";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();</script><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/cookieconsent/3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/lightgallery/1.6.8/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/justifiedGallery/3.7.0/css/justifiedGallery.min.css"><!--!--><!--!--><script src="https://cdnjs.loli.net/ajax/libs/pace/1.0.2/pace.min.js"></script><!--!--><!--!--><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="0wl’s Blog" type="application/atom+xml">
</head><body class="is-3-column"><script type="text/javascript" src="/js/imaegoo/night.js"></script><canvas id="universe"></canvas><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img class="logo-img" src="/" alt="0wl’s Blog" height="28"><img class="logo-img-dark" src="/" alt="0wl’s Blog" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">首页</a><a class="navbar-item" href="/archives/">时间轴</a><a class="navbar-item" href="/categories/">分类</a><a class="navbar-item" href="/tags/">标签</a><a class="navbar-item" href="/about/">关于</a><a class="navbar-item" href="/friends/">友链</a></div><div class="navbar-end"><a class="navbar-item is-hidden-tablet catalogue" title="目录" href="javascript:;"><i class="fas fa-list-ul"></i><span>  目录</span></a><a class="navbar-item night" id="night-nav" title="Night Mode" href="javascript:;"><i class="fas fa-moon" id="night-icon"></i></a><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/0wl-alt"><i class="fab fa-github"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-9-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2021-03-27T07:10:15.000Z" title="2021/3/27 下午3:10:15">2021-03-27</time>发表</span><span class="level-item"><time dateTime="2021-11-16T14:54:13.031Z" title="2021/11/16 下午10:54:13">2021-11-16</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/Hgame2021/">Hgame2021</a></span><span class="level-item">14 分钟读完 (大约2169个字)</span><span class="level-item leancloud_visitors" id="/2021/03/27/HGAME-Week4-Writeup/" data-flag-title="HGAME-Week4-Writeup"><i class="far fa-eye"></i>&nbsp;&nbsp;<span id="twikoo_visitors"><i class="fa fa-spinner fa-spin"></i></span>次访问</span></div></div><h1 class="title is-3 is-size-4-mobile">HGAME-Week4-Writeup</h1><div class="content"><article class="message is-info"><div class="message-body">
<p>Week4</p>
</div></article>

 <span id="more"></span>

<h2 id="Re"><a href="#Re" class="headerlink" title="Re"></a>Re</h2><h3 id="1-vm"><a href="#1-vm" class="headerlink" title="1.vm"></a>1.vm<img src="/2021/03/27/HGAME-Week4-Writeup/re1(4).png" class=""></h3><p>​    这部分逻辑很清晰，重点在中间这个加密的部分，点进去查看这个函数发现 switch-case 应该是vm，每个case都是一个 opcode</p>
<p>​    题目里说 ovm++ hates debugger ，那就先调试一下，调试后可以猜测出具体的加密部分</p>
<img src="/2021/03/27/HGAME-Week4-Writeup/re1(2).png" class="">

<img src="/2021/03/27/HGAME-Week4-Writeup/re1(3).png" class="">

<p>​    输入的 flag 先是经过异或加密，之后又有减法操作，加密后与密文进行比较，写脚本解一下就能得到 flag</p>
<img src="/2021/03/27/HGAME-Week4-Writeup/re1.png" class="">
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">cipher = [<span class="number">0xcf</span>,<span class="number">0xbf</span>,<span class="number">0x80</span>,<span class="number">0x3b</span>,<span class="number">0xf6</span>,<span class="number">0xaf</span>,<span class="number">0x7e</span>,<span class="number">0x02</span>,<span class="number">0x24</span>,<span class="number">0xed</span>,<span class="number">0x70</span>,<span class="number">0x3a</span>,<span class="number">0xf4</span>,<span class="number">0xeb</span>,<span class="number">0x7a</span>,<span class="number">0x4a</span>,<span class="number">0xe7</span>,<span class="number">0xf7</span>,<span class="number">0xa2</span>,<span class="number">0x67</span>,<span class="number">0x17</span>,<span class="number">0xf0</span>,<span class="number">0xc6</span>,<span class="number">0x76</span>,<span class="number">0x36</span>,<span class="number">0xe8</span>,<span class="number">0xad</span>,<span class="number">0x82</span>,<span class="number">0x2e</span>,<span class="number">0xdb</span>,<span class="number">0xb7</span>,<span class="number">0x4f</span>,<span class="number">0xe6</span>,<span class="number">0x09</span>]</span><br><span class="line">table1 = [<span class="number">0xFE</span>,<span class="number">0x21</span>,<span class="number">0x44</span>,<span class="number">0x67</span>,<span class="number">0x8A</span>,<span class="number">0xAD</span>,<span class="number">0xD0</span>,<span class="number">0xF3</span>,<span class="number">0x16</span>,<span class="number">0x39</span>,<span class="number">0x5c</span>,<span class="number">0x7f</span>,<span class="number">0xa2</span>,<span class="number">0xc5</span>,<span class="number">0xe8</span>,<span class="number">0x0b</span>,<span class="number">0x2e</span>,<span class="number">0x51</span>,<span class="number">0x74</span>,<span class="number">0x97</span>,<span class="number">0xba</span>,<span class="number">0xdd</span>,<span class="number">0x00</span>,<span class="number">0x23</span>,<span class="number">0x46</span>,<span class="number">0x69</span>,<span class="number">0x8c</span>,<span class="number">0xaf</span>,<span class="number">0xd2</span>,<span class="number">0xf5</span>,<span class="number">0x18</span>,<span class="number">0x3b</span>,<span class="number">0x5e</span>,<span class="number">0x81</span>]</span><br><span class="line">table2 = [<span class="number">0x7a</span>,<span class="number">0x1a</span>,<span class="number">0xba</span>,<span class="number">0x5a</span>,<span class="number">0xfa</span>,<span class="number">0x9a</span>,<span class="number">0x3a</span>,<span class="number">0xda</span>,<span class="number">0x7a</span>,<span class="number">0x1a</span>,<span class="number">0xba</span>,<span class="number">0x5a</span>,<span class="number">0xfa</span>,<span class="number">0x9a</span>,<span class="number">0x3a</span>,<span class="number">0xda</span>,<span class="number">0x7a</span>,<span class="number">0x1a</span>,<span class="number">0xba</span>,<span class="number">0x5a</span>,<span class="number">0xfa</span>,<span class="number">0x9a</span>,<span class="number">0x3a</span>,<span class="number">0xda</span>,<span class="number">0x7a</span>,<span class="number">0x1a</span>,<span class="number">0xba</span>,<span class="number">0x5a</span>,<span class="number">0xfa</span>,<span class="number">0x9a</span>,<span class="number">0x3a</span>,<span class="number">0xda</span>,<span class="number">0x7a</span>,<span class="number">0x1a</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">34</span>):</span><br><span class="line">  <span class="keyword">if</span> cipher[i] + table2[<span class="number">33</span>-i] &lt; <span class="number">256</span>:</span><br><span class="line">    cipher[i] += table2[<span class="number">33</span>-i]</span><br><span class="line">  <span class="keyword">else</span>:</span><br><span class="line">    cipher[i] = cipher[i] + table2[<span class="number">33</span>-i] - <span class="number">256</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">34</span>):</span><br><span class="line">  cipher[i] ^= table1[<span class="number">33</span>-i]</span><br><span class="line">  <span class="built_in">print</span>(<span class="built_in">chr</span>(cipher[i]),end = <span class="string">&quot;&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>​    这道题标准解法应该不是这样解的，而是要先要翻译出对应的汇编代码再分析，但这部分我还不太明白之后再补上吧</p>
<h3 id="2-A-5-Second-Challenge"><a href="#2-A-5-Second-Challenge" class="headerlink" title="2.A 5 Second Challenge"></a>2.A 5 Second Challenge</h3><p>​    这题要感谢小圆学长的耐心回答!!</p>
<p>​    下载得到的是用unity制作的扫雷游戏，刚开始为了获得源码用 il2cppdumper 处理 GameAssembly.dll ，但发现处理后得到的不全，之后问了一下小圆学长发现源码已经给了。</p>
<img src="/2021/03/27/HGAME-Week4-Writeup/re2.png" class="">

<p>​    打开 AFiveSecondChallenge.cpp ，源码里有 getUnixtime 这类获取时间的函数，游戏时间超过 5s 就会显示超时，用锁住系统时间的软件可以避开这一检测。锁定时间后就可以开始玩扫雷，几局下来后会发现雷的位置能构成二维码</p>
<img src="/2021/03/27/HGAME-Week4-Writeup/re2(2).png" class="">

<p>​    根据题目提示，把 managed 文件夹下的 dll 拖到 ida 里，会发现有一个函数被nop掉了，定位到源码里查看（il2cpp的中间文件有些混乱，删除了影响判断的部分）</p>
<img src="/2021/03/27/HGAME-Week4-Writeup/re2(3).png" class="">

<p>​    这里的 return <strong>判断是否是雷的位置</strong>，本来分析到这里已经很清楚了但是因为我完全不懂类和方法什么的看了挺久</p>
<img src="/2021/03/27/HGAME-Week4-Writeup/re2(4).png" class="">

<p>​    GetAt函数的返回值没在源码里看到有初始赋值于是迷惑了好久，又去问了一下小圆学长这部分是在哪里初始化过，得到回复说是在那个 dll 里面。</p>
<p>​    但是我在我下载的东西里面没发现 m_Items 初始化的部分，去网站上重新下载并拖到 ilspy ，得到了这个数组里的值</p>
<img src="/2021/03/27/HGAME-Week4-Writeup/re2(5).png" class="">

<p>​    接下来就是写脚本解题</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;math.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">double</span> matrix[<span class="number">45</span>][<span class="number">15</span>][<span class="number">3</span>] = ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">GetAt</span><span class="params">(i, j, k)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> iBound = <span class="number">45</span>;	<span class="comment">//45</span></span><br><span class="line">  <span class="keyword">int</span> jBound = <span class="number">15</span>;	<span class="comment">//15</span></span><br><span class="line">  <span class="keyword">int</span> kBound = <span class="number">3</span>;	<span class="comment">//3</span></span><br><span class="line">  <span class="keyword">return</span> matrix[i][j][k];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> y,x;</span><br><span class="line">  FILE* fp;</span><br><span class="line">  fp = fopen(<span class="string">&quot;************&quot;</span> , <span class="string">&quot;w&quot;</span>);</span><br><span class="line">  <span class="keyword">int</span> a[<span class="number">45</span>][<span class="number">45</span>];</span><br><span class="line">  <span class="keyword">int</span> i, j;</span><br><span class="line">  <span class="keyword">for</span> (y = <span class="number">0</span>; y &lt; <span class="number">45</span>; y++)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> (x = <span class="number">0</span>; x &lt; <span class="number">45</span>; x++)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">double</span> L_8 = GetAt(y, x / <span class="number">3</span>, <span class="number">0</span>);</span><br><span class="line">      <span class="keyword">double</span> L_14 = GetAt(y, x / <span class="number">3</span>, <span class="number">1</span>);</span><br><span class="line">      <span class="keyword">double</span> V_0 = L_14;</span><br><span class="line">      <span class="keyword">double</span> L_20 = GetAt(y, x / <span class="number">3</span>, <span class="number">2</span>);</span><br><span class="line">      <span class="keyword">double</span> V_1 = L_20;</span><br><span class="line">      <span class="keyword">double</span> V_2 = <span class="built_in">fmod</span>(x, <span class="number">3.0f</span>) - <span class="number">1.0f</span>;</span><br><span class="line">      a[x][y] = L_8* V_2* V_2 + V_0 * V_2 + V_1 &gt; <span class="number">0.0</span> ? <span class="number">1</span> : <span class="number">0</span>;	<span class="comment">//1是雷</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">45</span>; i++)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">45</span>; j++)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>, a[j][i]);</span><br><span class="line">      <span class="keyword">if</span> (a[j][i] == <span class="number">1</span>)</span><br><span class="line">        <span class="built_in">fprintf</span>(fp, <span class="string">&quot;%d,%d\n&quot;</span>, j, i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  fclose(fp);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">x,y = np.loadtxt(<span class="string">&#x27;./xy.txt&#x27;</span>,delimiter=<span class="string">&#x27;,&#x27;</span>,unpack=<span class="literal">True</span>)</span><br><span class="line">plt.plot(x,y,<span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>

<img src="/2021/03/27/HGAME-Week4-Writeup/re2(6).png" class="">

<h3 id="3-nllvm"><a href="#3-nllvm" class="headerlink" title="3.nllvm"></a>3.nllvm</h3><p>​    拖到 ida 里发现挺乱的，也没看到控制台输出的那些文字，那就先调试看看</p>
<img src="/2021/03/27/HGAME-Week4-Writeup/re3(5).png" class="">

<p>​    调试后发现这些异或操作得到的就是控制台输出的字符，在输出后又来了一遍异或还原。</p>
<p>​    接着调试发现判断输入字符串的地方</p>
<img src="/2021/03/27/HGAME-Week4-Writeup/re3(4).png" class="">

<p>​    这一部分异或得到 <strong>“CryptoFAILUREforRSA2048Key!!!!!!”</strong>  这个字符串，接着来到加密的函数</p>
<img src="/2021/03/27/HGAME-Week4-Writeup/re3(3).png" class="">

<p>​    传入的就是这部分异或得到字符串和输入的 flag，之后看了一下这个函数里面是一些比较复杂的运算猜测是某种算法，我对各种算法不是很熟所以用了 ida 插件 findcrypt ，但是这个插件并没有找到什么算法于是我就去找学长确认了一下</p>
<img src="/2021/03/27/HGAME-Week4-Writeup/re3(9).png" class="">

<p>​    查了各种算法，最后发现加密函数里面的一个函数像是<strong>s盒</strong>，根据s盒数字判断又是 <strong>AES 加密</strong>  ( s盒也是异或得到的，这大概是插件检测不出算法的原因 )</p>
<img src="/2021/03/27/HGAME-Week4-Writeup/re3(2).png" class="">

<p>​    在调试过程中可以知道 <strong>iv值是 123456789abcdef</strong> ，判断是否为正确 flag 的部分与密文进行比较，改变了输出字符的外观（表示是否回到现实）</p>
<img src="/2021/03/27/HGAME-Week4-Writeup/re3(6).png" class="">

<p>​    之后用我在week2写的脚本解就行</p>
<img src="/2021/03/27/HGAME-Week4-Writeup/re3.png" class="">

<p>​    查了一下题目里的 llvm ，是一款代码混淆器，具体的是看了这篇文章<a target="_blank" rel="noopener" href="https://bbs.pediy.com/thread-224484.htm">https://bbs.pediy.com/thread-224484.htm</a></p>
<h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><h3 id="1-Akira之瞳-1"><a href="#1-Akira之瞳-1" class="headerlink" title="1.Akira之瞳-1"></a>1.Akira之瞳-1</h3><p>​    查资料知道这种 dump 出来的RAW 文件要在 linux 里用 <strong>volatility</strong> 看，先查一下系统版本</p>
<img src="/2021/03/27/HGAME-Week4-Writeup/misc1(6).png" class="">

<p>​    接着用 pslist 查看一下系统进程，找到可疑的进程后 dump 出来</p>
<img src="/2021/03/27/HGAME-Week4-Writeup/misc1(5).png" class="">

<p>​    用 foremost 分离出一个加密的压缩包，本来以为密码还在 raw 文件里面的某个文件里来回看了好多遍，之后用 010editor 打开压缩包后发现提示，zip 密码是<strong>系统登陆密码</strong></p>
<img src="/2021/03/27/HGAME-Week4-Writeup/misc1(3).png" class="">

<p>​    hashdump 一下得到登陆密码的 hash 值</p>
<img src="/2021/03/27/HGAME-Week4-Writeup/misc1(4).jpg" class="">

<p>​    按提示把密码解出来</p>
<img src="/2021/03/27/HGAME-Week4-Writeup/misc1.png" class="">

<img src="/2021/03/27/HGAME-Week4-Writeup/misc1(2).png" class="">

<p>​    打开压缩包后发现两张图片，名字是src 和 blind，很容易就想到<strong>盲水印</strong>，用这个工具 (<a target="_blank" rel="noopener" href="https://github.com/chishaxie/BlindWaterMark">https://github.com/chishaxie/BlindWaterMark</a>) 提取出水印</p>
<img src="/2021/03/27/HGAME-Week4-Writeup/flag.png" class="">

<p>​    图片里小写的 L 是数字1</p>
<h3 id="2-Akira之瞳-2"><a href="#2-Akira之瞳-2" class="headerlink" title="2.Akira之瞳-2"></a>2.Akira之瞳-2</h3><p>​    得到一个加密压缩包和 RAW 文件，同样先查看一下进程，发现 notepad进程 dump出来</p>
<img src="/2021/03/27/HGAME-Week4-Writeup/misc2(5).png" class="">

<p>​    在 dump 出来的进程里查一下 password 字符串，得到 zip 密码</p>
<img src="/2021/03/27/HGAME-Week4-Writeup/misc2(6).png" class="">

<p>​    打开压缩包得到</p>
<img src="/2021/03/27/HGAME-Week4-Writeup/misc2.png" class="">

<p>​    这几个文件名好像在哪里见过，翻了一下往年的 writeup 知道container 是<strong>加密容器</strong>，cookies 是chrome浏览器的 <strong>cookie 数据库</strong>。但是看 cookies 文件内容和打开加密卷都需要密码，回到 linux 里再查一下有无密码，因为是 notepad 进程那就查 <strong>txt 文件</strong></p>
<img src="/2021/03/27/HGAME-Week4-Writeup/misc2(8).png" class="">

<p>​    这个 <strong>dumpme.txt</strong> 很可疑，提取出来发现之前 zip 密码还有后半句。百度一下知道 lastpass 是 chrome 浏览器的插件，用来记录密码的，把 lastpass 和 dump 放在一起搜索找到 volatility 里有 lastpass 这个插件</p>
<img src="/2021/03/27/HGAME-Week4-Writeup/misc2(7).png" class="">

<p>​    得到一个密码，下载 <strong>ChromeCookiesView</strong> ，加载 cookies 文件并输入密码，得到加密容器密码并提示用 <strong>VeraCrypt</strong> 打开</p>
<img src="/2021/03/27/HGAME-Week4-Writeup/misc2(2).png" class="">

<img src="/2021/03/27/HGAME-Week4-Writeup/misc2(3).png" class="">

<p>​    打开虚拟分区得到一张图片，查 ADS 得知 NTFS 隐写</p>
<blockquote>
<p>​    NTFS交换数据流（Alternate Data Streams，简称ADS）是NTFS磁盘格式的一个特性。在NTFS文件系统下，每个文件都可以存在多个数据流，意思是除了主文件流之外还可以有许多非主文件流寄宿在主文件流中，这些利用NTFS数据流寄宿并隐藏在系统中的非主文件流我们称之为ADS流文件。虽然我们无法看到ADS流文件，但它们却是真实存在。</p>
</blockquote>
<p>​    然后用 <strong>Ntfs Streams Editor</strong> 这个软件查看 ADS 流文件，得到 flag</p>
<img src="/2021/03/27/HGAME-Week4-Writeup/misc2(4).png" class="">

<p>​    那个网址里的图是 Akira 学长的新头像</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>​    为时四周的 hgme 要结束了，这个寒假学到了很多东西过得很充实，希望以后能继续学习这方面的知识，不断进步</p>
</div><div class="article-licensing box"><div class="licensing-title"><p>HGAME-Week4-Writeup</p><p><a href="https://www.0wl.site/2021/03/27/HGAME-Week4-Writeup/">https://www.0wl.site/2021/03/27/HGAME-Week4-Writeup/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>作者</h6><p>0wl</p></div></div><div class="level-item is-narrow"><div><h6>发布于</h6><p>2021-03-27</p></div></div><div class="level-item is-narrow"><div><h6>更新于</h6><p>2021-11-16</p></div></div><div class="level-item is-narrow"><div><h6>许可协议</h6><p><a class="icon" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a><a class="icon" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a><a class="icon" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/hgame/">hgame</a></div><div class="a2a_kit a2a_kit_size_32 a2a_default_style"><a class="a2a_dd" target="_blank" rel="noopener" href="https://www.addtoany.com/share"></a><a class="a2a_button_facebook"></a><a class="a2a_button_twitter"></a><a class="a2a_button_telegram"></a><a class="a2a_button_whatsapp"></a><a class="a2a_button_reddit"></a></div><script src="https://static.addtoany.com/menu/page.js" defer></script></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">喜欢这篇文章？打赏一下作者吧</h3><div class="buttons is-centered"><a class="button donate" href="/" target="_blank" rel="noopener" data-type="afdian"><span class="icon is-small"><i class="fas fa-charging-station"></i></span><span>爱发电</span></a><a class="button donate" data-type="alipay"><span class="icon is-small"><i class="fab fa-alipay"></i></span><span>支付宝</span><span class="qrcode"><img src="/img/alipay.jpg" alt="支付宝"></span></a><a class="button donate" href="/" target="_blank" rel="noopener" data-type="buymeacoffee"><span class="icon is-small"><i class="fas fa-coffee"></i></span><span>送我杯咖啡</span></a><a class="button donate" href="/" target="_blank" rel="noopener" data-type="patreon"><span class="icon is-small"><i class="fab fa-patreon"></i></span><span>Patreon</span></a><a class="button donate" data-type="wechat"><span class="icon is-small"><i class="fab fa-weixin"></i></span><span>微信</span><span class="qrcode"><img src="/img/wechat.png" alt="微信"></span></a></div></div></div><div class="card"><nav class="post-navigation mt-4 level is-mobile card-content"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2021/03/31/HGAME-Pwn-%E9%A2%98%E5%AD%A6%E4%B9%A0/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">HGAME  Pwn 题学习</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2021/03/27/HGAME-Week3-Writeup/"><span class="level-item">HGAME-Week3-Writeup</span><i class="level-item fas fa-chevron-right"></i></a></div></nav></div><div class="card"><div class="card-content"><h3 class="title is-5">评论</h3><div class="content twikoo" id="twikoo"></div><script src="https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js"></script><script>twikoo.init({
      envId: 'blog-9gu02qis60845ab5'
    });</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1 is-sticky"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="/img/avatar.jpg" alt="0wl"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">0wl</p><p class="is-size-6 is-block">HDU / CTFer / Re</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Hangzhou, China</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">17</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">1</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">13</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/0wl-alt" target="_blank" rel="noopener" id="widget-follow">Follow</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/0wl-alt"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Facebook" href="https://facebook.com"><i class="fab fa-facebook"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/atom.xml"><i class="fas fa-rss"></i></a></div></div></div><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">目录</h3><ul class="menu-list"><li><a class="level is-mobile" href="#Re"><span class="level-left"><span class="level-item">Re</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#1-vm"><span class="level-left"><span class="level-item">1.vm</span></span></a></li><li><a class="level is-mobile" href="#2-A-5-Second-Challenge"><span class="level-left"><span class="level-item">2.A 5 Second Challenge</span></span></a></li><li><a class="level is-mobile" href="#3-nllvm"><span class="level-left"><span class="level-item">3.nllvm</span></span></a></li></ul></li><li><a class="level is-mobile" href="#Misc"><span class="level-left"><span class="level-item">Misc</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#1-Akira之瞳-1"><span class="level-left"><span class="level-item">1.Akira之瞳-1</span></span></a></li><li><a class="level is-mobile" href="#2-Akira之瞳-2"><span class="level-left"><span class="level-item">2.Akira之瞳-2</span></span></a></li></ul></li><li><a class="level is-mobile" href="#总结"><span class="level-left"><span class="level-item">总结</span></span></a></li></ul></div></div><style>#toc .menu-list > li > a.is-active + .menu-list { display: block; }#toc .menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/MFC/"><span class="tag">MFC</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/gdb/"><span class="tag">gdb</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/hgame/"><span class="tag">hgame</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/idapython/"><span class="tag">idapython</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/pwn/"><span class="tag">pwn</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/qemu/"><span class="tag">qemu</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/re/"><span class="tag">re</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/riscv/"><span class="tag">riscv</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ruby/"><span class="tag">ruby</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/upx/"><span class="tag">upx</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/windows/"><span class="tag">windows</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/wp/"><span class="tag">wp</span><span class="tag">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%8F%8D%E8%B0%83%E8%AF%95/"><span class="tag">反调试</span><span class="tag">1</span></a></div></div></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img class="logo-img" src="/" alt="0wl’s Blog" height="28"><img class="logo-img-dark" src="/" alt="0wl’s Blog" height="28"></a><p class="is-size-7"><span>&copy; 2021 0wl</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/imaegoo/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a><br><span id="busuanzi_container_site_uv">共<span id="busuanzi_value_site_uv">0</span>个访客</span></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdnjs.loli.net/ajax/libs/jquery/3.3.1/jquery.min.js"></script><script src="https://cdnjs.loli.net/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"></script><script src="https://cdnjs.loli.net/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" defer></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script>if (typeof 623 !== 'undefined' 
            && true == true) {
            $(document).ready(function () {
                var int = setInterval(fixCount, 100);
                var busuanziSiteOffset = parseInt(623);
                function fixCount() {
                    if ($("#busuanzi_container_site_uv").css("display") != "none" && parseInt($("#busuanzi_value_site_uv").html()) > 0) {
                        clearInterval(int);
                        $("#busuanzi_value_site_uv").html(parseInt($("#busuanzi_value_site_uv").html()) + busuanziSiteOffset);
                    }
                }
            });
        }</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><!--!--><script src="https://cdnjs.loli.net/ajax/libs/cookieconsent/3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "此网站使用 Cookie，以启用评论系统和分析功能。",
          dismiss: "知道了",
          allow: "允许使用Cookie",
          deny: "拒绝",
          link: "了解更多",
          policy: "Cookie政策",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdnjs.loli.net/ajax/libs/lightgallery/1.6.8/js/lightgallery.min.js" defer></script><script src="https://cdnjs.loli.net/ajax/libs/justifiedGallery/3.7.0/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><div class="searchbox-pinyin"><label class="checkbox"><input id="search-by-pinyin" type="checkbox" checked="checked"><span> 拼音检索</span></label></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/imaegoo/pinyin.js" defer></script><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script><script type="text/javascript" src="/js/imaegoo/imaegoo.js"></script><script type="text/javascript" src="/js/imaegoo/universe.js"></script><script type="text/javascript" src="/js/live2d/autoload.js"></script></body></html>