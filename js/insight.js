"use strict";function loadInsight(n,f){var t=$(".searchbox"),h=t.find(".searchbox-input"),p=t.find(".searchbox-body"),e=t.find("#search-by-pinyin");function g(n,t){return!!e.prop("checked")&&PinyinMatch.match(n,t)}function d(n,t,e){if(!Array.isArray(t)||!t.length||!n)return e?n.slice(0,e):n;var r=n.toLowerCase();if(!(t=t.map(function(n){var t=r.indexOf(n.toLowerCase());return n&&-1!==t?[t,t+n.length]:(n=g(r,n.toLowerCase()))?[n[0],n[1]+1]:null}).filter(function(n){return null!==n}).sort(function(n,t){return n[0]-t[0]||n[1]-t[1]})).length)return n;var o,a,s="",i=0,c=(o=void 0,a=[],t.forEach(function(n){!o||n[0]>o[1]?a.push(o=n):n[1]>o[1]&&(o[1]=n[1])}),a),l=[c[0][0],c[c.length-1][1]];e&&e<l[1]&&(i=l[0]);for(var u=0;u<c.length;u++){var f=c[u];if(s+=n.slice(i,Math.min(f[0],l[0]+e)),e&&f[0]>=l[0]+e)break;s+="<em>"+n.slice(f[0],f[1])+"</em>",i=f[1],u===c.length-1&&(s+=e?n.slice(f[1],Math.min(n.length,l[0]+e+1)):n.slice(f[1]))}return s}function v(n,t,e,r,o){return'<a class="searchbox-result-item" href="'+o+'">\n            <span class="searchbox-result-icon">\n                <i class="fa fa-'+n+'" />\n            </span>\n            <span class="searchbox-result-content">\n                <span class="searchbox-result-title">\n                    '+(t=null!=t&&""!==t?t:f.untitled)+"\n                    "+(e?'<span class="searchbox-result-title-secondary">('+e+")</span>":"")+"\n                </span>\n                "+(r?'<span class="searchbox-result-preview">'+r+"</span>":"")+"\n            </span>\n        </a>"}function m(n){return n.split(" ").filter(function(n){return!!n}).map(function(n){return n.toLowerCase()})}function b(n,e,r){return(n=m(n)).filter(function(t){return 0<r.filter(function(n){return!!Object.prototype.hasOwnProperty.call(e,n)&&(-1<e[n].toLowerCase().indexOf(t)||!!g(e[n].toLowerCase(),t))}).length}).length===n.length}function x(n,r,t,o){var a=0;return m(n).forEach(function(n){var e=new RegExp(n,"img");t.forEach(function(n,t){Object.prototype.hasOwnProperty.call(r,n)&&(n=r[n].match(e),a+=n?n.length*o[t]:0)})}),a}function r(n){var t=$.makeArray(p.find(".searchbox-result-item")),e=-1;t.forEach(function(n,t){$(n).hasClass("active")&&(e=t)});var r,o=(t.length+e+n)%t.length;$(t[e]).removeClass("active"),$(t[o]).addClass("active"),0!==(r=$(t[o])).length&&(n=p[0].clientHeight,t=r.position().top-p.scrollTop(),(o=r[0].clientHeight+r.position().top)>n+p.scrollTop()&&p.scrollTop(o-p[0].clientHeight),t<0&&p.scrollTop(r.position().top))}function o(n){n&&n.length&&(location.href=n.attr("href"))}$.getJSON(n.contentUrl,function(u){function n(){var n,t,e,r,o,a,s,i,c,l=h.val();!function(n,t){for(var e in p.empty(),t)p.append(function(r,o,n){var t=void 0;if(0===n.length)return null;var e=f[o.toLowerCase()];switch(o){case"POSTS":case"PAGES":t=n.map(function(n){return v("file",d(n.title,r),null,d(n.text,r,100),n.link)});break;case"CATEGORIES":case"TAGS":t=n.map(function(n){var t=d(n.name,r),e=d(n.slug,r);return v("CATEGORIES"===o?"folder":"tag",t,e,null,n.link)});break;default:return null}return $("<section>").addClass("searchbox-result-section").append($("<header>").text(e)).append(t)}(m(n),e.toUpperCase(),t[e]))}(l,(o=function(n){return x(e,n,["title","text"],[3,1])},a=function(n){return x(e,n,["title","text"],[3,1])},s=function(n){return x(e,n,["name","slug"],[1,1])},i=function(n){return x(e,n,["name","slug"],[1,1])},r=e=t=l,c=(n=u).posts,l=u.pages,t=u.tags,n=u.categories,{posts:c.filter((c={post:function(n){return b(r,n,["title","text"])},page:function(n){return b(r,n,["title","text"])},category:function(n){return b(r,n,["name","slug"])},tag:function(n){return b(r,n,["name","slug"])}}).post).sort(function(n,t){return o(t)-o(n)}).slice(0,5),pages:l.filter(c.page).sort(function(n,t){return a(t)-a(n)}).slice(0,5),categories:n.filter(c.category).sort(function(n,t){return s(t)-s(n)}).slice(0,5),tags:t.filter(c.tag).sort(function(n,t){return i(t)-i(n)}).slice(0,5)}))}"#insight-search"===location.hash.trim()&&t.addClass("show"),h.on("input",n),e.on("change",n),h.trigger("input")});var a=!1;$(document).on("click focus",".navbar-main .search",function(){t.addClass("show"),t.find(".searchbox-input").focus()}).on("click touchend",".searchbox-result-item",function(n){"click"!==n.type&&!a||(o($(this)),a=!1)}).on("click touchend",".searchbox-close",function(n){"click"!==n.type&&!a||($(".navbar-main").css("pointer-events","none"),setTimeout(function(){$(".navbar-main").css("pointer-events","auto")},400),t.removeClass("show"),a=!1)}).on("keydown",function(n){if(t.hasClass("show"))switch(n.keyCode){case 27:t.removeClass("show");break;case 38:r(-1);break;case 40:r(1);break;case 13:o(p.find(".searchbox-result-item.active").eq(0))}}).on("touchstart",function(n){a=!0}).on("touchmove",function(n){a=!1})}